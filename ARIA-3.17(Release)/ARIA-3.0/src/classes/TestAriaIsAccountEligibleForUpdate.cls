/**
 * This class contains unit tests for validating the behavior of Apex classes
 * and triggers.
 *
 * Unit tests are class methods that verify whether a particular piece
 * of code is working properly. Unit test methods take no arguments,
 * commit no data to the database, and are flagged with the testMethod
 * keyword in the method definition.
 *
 * All test methods in an organization are executed whenever Apex code is deployed
 * to a production organization to confirm correctness, ensure code
 * coverage, and prevent regressions. All Apex classes are
 * required to have at least 75% code coverage in order to be deployed
 * to a production organization. In addition, all triggers must have some code coverage.
 * 
 * The @isTest class annotation indicates this class only contains test
 * methods. Classes defined with the @isTest annotation do not count against
 * the organization size limit for all Apex scripts.
 *
 * See the Apex Language Reference for more information about Testing and Code Coverage.
 */
@isTest
private class TestAriaIsAccountEligibleForUpdate {

    static testMethod void myUnitTest() {
        // TO DO: implement unit test
        
         // setup config
        AriaTestDataGenerator.createAndInsertDefaultConfigWithSuppFields();
        
        // Account
        Account a = AriaTestDataGenerator.getOneAccount();
        
        // add Aria fields to Account
        a.Aria_Id__c = '1188730';
        String ariaId = '1188730';
        // update Account
        AriaUtil.SUPPRESS_ACCOUNT_UPDATE_CALLOUT = true;
        update a;
        
        
        Test.startTest();
        
        // call the method
        
        AriaIsAccountEligibleForUpdate callout = new AriaIsAccountEligibleForUpdate();
        callout.hasValidMasterPlan(a.Id);
        callout.hasValidMasterPlanWithAriaId(ariaId);
         
        System.assertEquals(true, true); // not much else we can do here...
       
        Test.stopTest();
    }
    
    static testMethod void testHandleResultError() {
        System.debug(LoggingLevel.WARN, '********** Called testHandleResultChangedMasterPlan method');
        
        // setup test data
        
        // setup config
        AriaTestDataGenerator.createAndInsertDefaultConfigWithSuppFields();
        
        // Account
        Account a = AriaTestDataGenerator.getAccountList()[0];
        
        // add an Aria Id to simulate a SF Account that has already been synced once to Aria
        a.Aria_Id__c = '1188730';
        
        // test data - error
        String sampleResponse = '\n<wddxPacket version=\'1.0\'><header/><data><struct><var name=\'error_code\'><number>1004</number></var><var name=\'error_msg\'><string>authentication error</string></var></struct></data></wddxPacket>\n';
        WDDXData w = new WDDXData();
        w = (new WDDXDeserializer(sampleResponse)).deserialize();
        
        
        Test.startTest();
        
        
        AriaIsAccountEligibleForUpdate callout = new AriaIsAccountEligibleForUpdate();
        
        try {
            Account result = callout.handleResult(a, w);
        } catch (AriaAPIException e) {
            // should throw an AriaAPIException
            System.debug('Caught expected Exception');
            System.assertEquals(true, true, 'Caught expected Exception');
        }
        
        Test.stopTest();
    }
    
    static testMethod void testHandleResultSuccess() {
        
        // setup test data
        
        // setup config
        AriaTestDataGenerator.createAndInsertDefaultConfigWithSuppFields();
        
        // Account
        Account a = AriaTestDataGenerator.getAccountList()[0];
        
        // add an Aria Id to simulate a SF Account that has already been synced once to Aria
        a.Aria_Id__c = '1188730';
        
        // test data - error
        String sampleResponse = '\n<wddxPacket version=\'1.0\'><header/><data><struct><var name=\'error_code\'><number>0</number></var><var name=\'error_msg\'><string>OK</string></var><var name=\'all_acct_plans\'><array length=\'4\'><struct><var name=\'plan_no\'><number>0</number></var><var name=\'plan_name\'><string>SF Tier Test</string></var><var name=\'plan_desc\'><string>Test plan for SF testing</string></var><var name=\'plan_date\'><string>2010-08-21</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><string>2012-08-21</string></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><string>2012-09-20</string></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>0</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><number>1</number></var><var name=\'rollover_acct_status_days\'><number>0</number></var><var name=\'init_free_months\'><number>0</number></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1010</number></var><var name=\'rate_schedule_name\'><string>test2</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>0</number></var><var name=\'supp_plan_status_cd\'><null/></var><var name=\'supp_plan_status_label\'><null/></var><var name=\'supp_plan_status_date\'><null/></var><var name=\'supp_plan_activate_date\'><null/></var><var name=\'supp_plan_terminate_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'3\'><struct><var name=\'service_no\'><number>106</number></var><var name=\'service_desc\'><string>Activation Fee</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>1</number></var><var name=\'is_misc_ind\'><number>1</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1000</string></var><var name=\'ledger_code\'><string>1000</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>25</number></var></struct></array></var></struct><struct><var name=\'service_no\'><number>103</number></var><var name=\'service_desc\'><string>Recurring Fee</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1001</string></var><var name=\'ledger_code\'><string>1001</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'3\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><number>5</number></var><var name=\'rate_per_unit\'><number>10</number></var></struct><struct><var name=\'rate_seq_no\'><number>2</number></var><var name=\'from_unit\'><number>6</number></var><var name=\'to_unit\'><number>10</number></var><var name=\'rate_per_unit\'><number>6</number></var></struct><struct><var name=\'rate_seq_no\'><number>3</number></var><var name=\'from_unit\'><number>11</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>3</number></var></struct></array></var></struct><struct><var name=\'service_no\'><number>100</number></var><var name=\'service_desc\'><string>Unit Usage</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>1</number></var><var name=\'usage_type\'><number>85</number></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>1</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'3\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><number>100</number></var><var name=\'rate_per_unit\'><number>0</number></var></struct><struct><var name=\'rate_seq_no\'><number>2</number></var><var name=\'from_unit\'><number>101</number></var><var name=\'to_unit\'><number>1000</number></var><var name=\'rate_per_unit\'><number>0.5</number></var></struct><struct><var name=\'rate_seq_no\'><number>3</number></var><var name=\'from_unit\'><number>1001</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>0.2</number></var></struct></array></var></struct></array></var></struct><struct><var name=\'plan_no\'><number>2</number></var><var name=\'plan_name\'><string>12345678901234567</string></var><var name=\'plan_desc\'><string>IMEI number</string></var><var name=\'plan_date\'><string>2012-09-09</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><null/></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><null/></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><null/></var><var name=\'rollover_acct_status_days\'><null/></var><var name=\'init_free_months\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1210</number></var><var name=\'rate_schedule_name\'><string>12345678901234567</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>1</number></var><var name=\'supp_plan_status_cd\'><number>1</number></var><var name=\'supp_plan_status_label\'><string>Active</string></var><var name=\'supp_plan_status_date\'><string>2012-09-09</string></var><var name=\'supp_plan_activate_date\'><string>2012-09-09</string></var><var name=\'supp_plan_terminate_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'1\'><struct><var name=\'service_no\'><number>103</number></var><var name=\'service_desc\'><string>Recurring Fee</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1001</string></var><var name=\'ledger_code\'><string>1001</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>100</number></var></struct></array></var></struct></array></var></struct><struct><var name=\'plan_no\'><number>3</number></var><var name=\'plan_name\'><string>monthly plan</string></var><var name=\'plan_desc\'><string>this is represent 20$</string></var><var name=\'plan_date\'><string>2012-09-20</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><string>2012-08-26</string></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><string>2012-09-20</string></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><null/></var><var name=\'rollover_acct_status_days\'><null/></var><var name=\'init_free_months\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1310</number></var><var name=\'rate_schedule_name\'><string>monthly plan</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>1</number></var><var name=\'supp_plan_status_cd\'><number>1</number></var><var name=\'supp_plan_status_label\'><string>Active</string></var><var name=\'supp_plan_status_date\'><string>2012-08-26</string></var><var name=\'supp_plan_activate_date\'><string>2012-08-26</string></var><var name=\'supp_plan_terminate_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'2\'><struct><var name=\'service_no\'><number>106</number></var><var name=\'service_desc\'><string>Activation Fee</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>1</number></var><var name=\'is_misc_ind\'><number>1</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1000</string></var><var name=\'ledger_code\'><string>1000</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>100</number></var></struct></array></var></struct><struct><var name=\'service_no\'><number>104</number></var><var name=\'service_desc\'><string>Recurring Fee</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1001</string></var><var name=\'ledger_code\'><string>1001</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>20</number></var></struct></array></var></struct></array></var></struct><struct><var name=\'plan_no\'><number>4</number></var><var name=\'plan_name\'><string>SF Supplemental</string></var><var name=\'plan_desc\'><null/></var><var name=\'plan_date\'><string>2012-08-26</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><null/></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><null/></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><null/></var><var name=\'rollover_acct_status_days\'><null/></var><var name=\'init_free_months\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1410</number></var><var name=\'rate_schedule_name\'><string>15</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>1</number></var><var name=\'supp_plan_status_cd\'><number>1</number></var><var name=\'supp_plan_status_label\'><string>Terminated</string></var><var name=\'supp_plan_status_date\'><string>2012-08-26</string></var><var name=\'supp_plan_activate_date\'><string>2012-08-26</string></var><var name=\'supp_plan_terminate_date\'><string>2012-08-26</string></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'2\'><struct><var name=\'service_no\'><number>101</number></var><var name=\'service_desc\'><string>Count Usage</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>1</number></var><var name=\'usage_type\'><number>87</number></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>1</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><null/></var></struct><struct><var name=\'service_no\'><number>102</number></var><var name=\'service_desc\'><string>Minute Usage</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>1</number></var><var name=\'usage_type\'><number>89</number></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>1</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><null/></var></struct></array></var></struct></array></var></struct></data></wddxPacket>\n';
        WDDXData w = new WDDXData();
        w = (new WDDXDeserializer(sampleResponse)).deserialize();
        
        
        Test.startTest();
        
        
        AriaIsAccountEligibleForUpdate callout = new AriaIsAccountEligibleForUpdate();
        
        try {
            callout.getAcctPlansAllEligibleForUpdateWithAriaId('123456');
            //Account result = callout.handleResult(a, w);
        } catch (AriaAPIException e) {
            // should throw an AriaAPIException
            System.debug('Caught expected Exception');
            System.assertEquals(true, true, 'Caught expected Exception');
        }
        
        Test.stopTest();
    }    
    
    /*
     static testMethod void testHandleResultChangedMasterPlan() {
        System.debug(LoggingLevel.WARN, '********** Called testHandleResultChangedMasterPlan method');
        
        // setup test data
        
        // setup config
        AriaTestDataGenerator.createAndInsertDefaultConfigWithSuppFields();
        
        // Account
        Account a = AriaTestDataGenerator.getAccountList()[0];
        
        // add an Aria Id to simulate a SF Account that has already been synced once to Aria
        a.Aria_Id__c = '1188730';
        
        // ClientPlans
        List<Client_Plan__c> cps = AriaTestDataGenerator.getClientPlanList();
        
        // generate ClientPlanRelationships
        List<Client_Plan_Relationship__c> cprs = AriaTestDataGenerator.getCPjoinList();
        
        // AccountPlans (with related AccountRateTiers)
        List<Account_Plan__c> aps = AriaTestDataGenerator.getAccountPlanList();
        
        // ClientPlanServices
        List<Client_Plan_Service__c> cpss = AriaTestDataGenerator.getCPserviceJoinList();
        
        // RateSchedules
        List<Rate_Schedule__c> rss = AriaTestDataGenerator.getRateScheduleList();
        
        // RateTiers
        List<Rate_Tier__c> rts = AriaTestDataGenerator.getRateTierList();
        
        // test data
        // this is "real" data from Aria except the Aria IDs have been changed to match the TestDataGenerator code
        String sampleResponse = '\n<wddxPacket version=\'1.0\'><header/><data><struct><var name=\'error_code\'><number>0</number></var><var name=\'error_msg\'><string>OK</string></var><var name=\'all_acct_plans\'><array length=\'4\'><struct><var name=\'plan_no\'><number>0</number></var><var name=\'plan_name\'><string>SF Tier Test</string></var><var name=\'plan_desc\'><string>Test plan for SF testing</string></var><var name=\'plan_date\'><string>2010-08-21</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><string>2012-08-21</string></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><string>2012-09-20</string></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>0</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><number>1</number></var><var name=\'rollover_acct_status_days\'><number>0</number></var><var name=\'init_free_months\'><number>0</number></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1010</number></var><var name=\'rate_schedule_name\'><string>test2</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>0</number></var><var name=\'supp_plan_status_cd\'><null/></var><var name=\'supp_plan_status_label\'><null/></var><var name=\'supp_plan_status_date\'><null/></var><var name=\'supp_plan_activate_date\'><null/></var><var name=\'supp_plan_terminate_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'3\'><struct><var name=\'service_no\'><number>106</number></var><var name=\'service_desc\'><string>Activation Fee</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>1</number></var><var name=\'is_misc_ind\'><number>1</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1000</string></var><var name=\'ledger_code\'><string>1000</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>25</number></var></struct></array></var></struct><struct><var name=\'service_no\'><number>103</number></var><var name=\'service_desc\'><string>Recurring Fee</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1001</string></var><var name=\'ledger_code\'><string>1001</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'3\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><number>5</number></var><var name=\'rate_per_unit\'><number>10</number></var></struct><struct><var name=\'rate_seq_no\'><number>2</number></var><var name=\'from_unit\'><number>6</number></var><var name=\'to_unit\'><number>10</number></var><var name=\'rate_per_unit\'><number>6</number></var></struct><struct><var name=\'rate_seq_no\'><number>3</number></var><var name=\'from_unit\'><number>11</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>3</number></var></struct></array></var></struct><struct><var name=\'service_no\'><number>100</number></var><var name=\'service_desc\'><string>Unit Usage</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>1</number></var><var name=\'usage_type\'><number>85</number></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>1</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'3\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><number>100</number></var><var name=\'rate_per_unit\'><number>0</number></var></struct><struct><var name=\'rate_seq_no\'><number>2</number></var><var name=\'from_unit\'><number>101</number></var><var name=\'to_unit\'><number>1000</number></var><var name=\'rate_per_unit\'><number>0.5</number></var></struct><struct><var name=\'rate_seq_no\'><number>3</number></var><var name=\'from_unit\'><number>1001</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>0.2</number></var></struct></array></var></struct></array></var></struct><struct><var name=\'plan_no\'><number>2</number></var><var name=\'plan_name\'><string>12345678901234567</string></var><var name=\'plan_desc\'><string>IMEI number</string></var><var name=\'plan_date\'><string>2012-09-09</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><null/></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><null/></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><null/></var><var name=\'rollover_acct_status_days\'><null/></var><var name=\'init_free_months\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1210</number></var><var name=\'rate_schedule_name\'><string>12345678901234567</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>1</number></var><var name=\'supp_plan_status_cd\'><number>1</number></var><var name=\'supp_plan_status_label\'><string>Active</string></var><var name=\'supp_plan_status_date\'><string>2012-09-09</string></var><var name=\'supp_plan_activate_date\'><string>2012-09-09</string></var><var name=\'supp_plan_terminate_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'1\'><struct><var name=\'service_no\'><number>103</number></var><var name=\'service_desc\'><string>Recurring Fee</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1001</string></var><var name=\'ledger_code\'><string>1001</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>100</number></var></struct></array></var></struct></array></var></struct><struct><var name=\'plan_no\'><number>3</number></var><var name=\'plan_name\'><string>monthly plan</string></var><var name=\'plan_desc\'><string>this is represent 20$</string></var><var name=\'plan_date\'><string>2012-09-20</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><string>2012-08-26</string></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><string>2012-09-20</string></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><null/></var><var name=\'rollover_acct_status_days\'><null/></var><var name=\'init_free_months\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1310</number></var><var name=\'rate_schedule_name\'><string>monthly plan</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>1</number></var><var name=\'supp_plan_status_cd\'><number>1</number></var><var name=\'supp_plan_status_label\'><string>Active</string></var><var name=\'supp_plan_status_date\'><string>2012-08-26</string></var><var name=\'supp_plan_activate_date\'><string>2012-08-26</string></var><var name=\'supp_plan_terminate_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'2\'><struct><var name=\'service_no\'><number>106</number></var><var name=\'service_desc\'><string>Activation Fee</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>1</number></var><var name=\'is_misc_ind\'><number>1</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1000</string></var><var name=\'ledger_code\'><string>1000</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>100</number></var></struct></array></var></struct><struct><var name=\'service_no\'><number>104</number></var><var name=\'service_desc\'><string>Recurring Fee</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1001</string></var><var name=\'ledger_code\'><string>1001</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>20</number></var></struct></array></var></struct></array></var></struct><struct><var name=\'plan_no\'><number>4</number></var><var name=\'plan_name\'><string>SF Supplemental</string></var><var name=\'plan_desc\'><null/></var><var name=\'plan_date\'><string>2012-08-26</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'queued_plan_units\'><null/></var><var name=\'units_change_date\'><null/></var><var name=\'last_bill_date\'><null/></var><var name=\'next_bill_date\'><string>2012-09-21</string></var><var name=\'bill_thru_date\'><null/></var><var name=\'bill_day\'><number>21</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><null/></var><var name=\'suspension_period\'><null/></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><null/></var><var name=\'rollover_acct_status_days\'><null/></var><var name=\'init_free_months\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>1410</number></var><var name=\'rate_schedule_name\'><string>15</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>1</number></var><var name=\'supp_plan_status_cd\'><number>1</number></var><var name=\'supp_plan_status_label\'><string>Terminated</string></var><var name=\'supp_plan_status_date\'><string>2012-08-26</string></var><var name=\'supp_plan_activate_date\'><string>2012-08-26</string></var><var name=\'supp_plan_terminate_date\'><string>2012-08-26</string></var><var name=\'client_receipt_id\'><null/></var><var name=\'plan_services\'><array length=\'2\'><struct><var name=\'service_no\'><number>101</number></var><var name=\'service_desc\'><string>Count Usage</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>1</number></var><var name=\'usage_type\'><number>87</number></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>1</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><null/></var></struct><struct><var name=\'service_no\'><number>102</number></var><var name=\'service_desc\'><string>Minute Usage</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>1</number></var><var name=\'usage_type\'><number>89</number></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>1</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'plan_service_rates\'><null/></var></struct></array></var></struct></array></var></struct></data></wddxPacket>\n';
        WDDXData w = new WDDXData();
        w = (new WDDXDeserializer(sampleResponse)).deserialize();
        
        
        // obtain the ID of the master AP for the original account
        List<Account_Plan__c> originalMasterAP = AriaPlanHelper.getAcctPlansWithTiers(' WHERE Account__c =\'' + a.Id + '\' AND Status__c = \'Active\' AND RecordType.Name= \'Master\'');
        Id originalMasterId = originalMasterAP[0].Id;
        
        Test.startTest();
        
        
        AriaIsAccountEligibleForUpdate callout = new AriaIsAccountEligibleForUpdate();
        
        
        Account result = callout.handleResult(a, w);
        
        // obtain the ID of the master AP for the new account
        List<Account_Plan__c> newMasterAP = AriaPlanHelper.getAcctPlansWithTiers(' WHERE Account__c =\'' + result.Id + '\' AND Status__c = \'Active\' AND RecordType.Name=\'Master\'');
        Id newMasterId = newMasterAP[0].Id;
        
        // the master APs of the Accounts should be different
        //System.assert(originalMasterId != newMasterId);
        
        Test.stopTest();                        
                                
    }
    */
    
    
}