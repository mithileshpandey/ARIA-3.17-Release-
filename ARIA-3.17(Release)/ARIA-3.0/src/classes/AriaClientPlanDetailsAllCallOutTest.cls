/**********************************************************************
Name:  AriaClientPlanDetailsAllCallOutTest()
Copyright Â© 2012  Aria
============================================================================================================
Purpose:                                                           
-------  
Tests the AriaClientPlanDetailsAllCallOut class                                               
============================================================================================================
History                                                           
-------                                                           
VERSION  AUTHOR                     DATE              DETAIL                       Change Request
   1.0 - Soliant Consulting (AR)    05/28/2012        INITIAL DEVELOPMENT          
 
***********************************************************************/
@isTest
private class AriaClientPlanDetailsAllCallOutTest {

    static testMethod void testClientPlanDetailsCallout() {
        AriaTestDataGenerator.createAndInsertDefaultConfigWithSuppFields();
        
        List<Client_Plan__c> plans =  AriaTestDataGenerator.getClientPlanList();
        
        test.startTest();
        
        //AriaClientPlansCallOut cOutPlans = new AriaClientPlansCallOut();
        
        AriaClientPlanDetailsAllCallOut cOut = new AriaClientPlanDetailsAllCallOut();
        try{
        cOut.processClientPlansDetailsAll('1');
        } catch(exception ex){
            
        }
        
        String response = '<wddxPacket version=\'1.0\'><header /><data><struct><var name=\'error_code\'><number>0</number></var><var name=\'error_msg\'><string>OK</string></var><var name=\'all_client_plans\'><array length=\'1\'><struct><var name=\'plan_no\'><number>1</number></var><var name=\'plan_name\'><string>mp sf 1436</string></var><var name=\'plan_desc\'><string>mp sf 1436</string></var><var name=\'supp_plan_ind\'><number>0</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null /></var><var name=\'rollover_plan_no\'><null /></var><var name=\'early_cancel_fee\'><null /></var><var name=\'early_cancel_min_months\'><null /></var><var name=\'suspension_period\'><null /></var><var name=\'new_acct_status\'><number>1</number></var><var name=\'rollover_acct_status\'><number>1</number></var><var name=\'rollover_acct_status_days\'><number>0</number></var><var name=\'init_free_months\'><number>0</number></var><var name=\'plan_2_assign_on_susp\'><null /></var><var name=\'default_notify_method\'><null /></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'plan_services\'><array length=\'1\'><struct><var name=\'service_no\'><number>101</number></var><var name=\'service_desc\'><string>Activation Fee</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null /></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>1</number></var><var name=\'is_misc_ind\'><number>1</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1000</string></var><var name=\'ledger_code\'><string>1000</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'usage_type_name\'><null /></var><var name=\'usage_type_desc\'><null /></var><var name=\'usage_type_code\'><null /></var><var name=\'usage_unit_label\'><null /></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null /></var><var name=\'rate_per_unit\'><number>25</number></var></struct></array></var><var name=\'all_plan_service_rates\'><array length=\'1\'><struct><var name=\'schedule_no\'><number>1</number></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null /></var><var name=\'rate_per_unit\'><number>25</number></var></struct></array></var></struct></array></var></struct></array></var><var name=\'plan_rate_schedules\'><array length=\'1\'><struct><var name=\'schedule_no\'><number>1</number></var><var name=\'schedule_name\'><string>s1</string></var><var name=\'schedule_currency\'><string>usd</string></var><var name=\'schedule_default_ind\'><number>1</number></var><var name=\'schedule_default_ind_curr\'><number>1</number></var><var name=\'schedule_display_ind\'><number>1</number></var></struct></array></var></struct></array></var></struct></data></wddxPacket>';
        WDDXDeserializer d = new WDDXDeserializer(response);
        //cOutPlans.handleResult(d.deserialize());
        cOut.handleResult(d.deserialize());
        
        List<Service__c> services = new List<Service__c>([Select Id from Service__c limit 1]);
        //system.assert(services.size()>0);
        
        List<Rate_Schedule__c> schedules = new List<Rate_Schedule__c>([Select Id from Rate_Schedule__c where Aria_Id__c='1']);
        //system.assert(schedules.size()>0);
        
        test.stopTest();
    }
      
    static testMethod void testhandleResult() {
      Id rtMaster = AriaUtil.getRecordTypeId('Master', 'ASF3__Client_Plan__c' );
      Client_Plan__c clientPlanObj = new Client_Plan__c( Name='Test Master Plan 222', Status__c='Active', Aria_Id__c='10353849', Rollover_Months__c='10', Rollover_Account_Status_Days__c='0', Recurring_Billing_Interval__c='1', Initial_Free_Months__c='No Free Months', RecordTypeId = rtMaster ,Default_Currency__c='USD');
      insert clientPlanObj;
      
      WDDXDeserializer d;
      d = new WDDXDeserializer('<wddxPacket version=\'1.0\'><header/><data><struct><var name=\'error_code\'><number>0</number></var><var name=\'error_msg\'><string>OK</string></var><var name=\'all_client_plan_dtls\'><array length=\'1\'><struct><var name=\'plan_no\'><number>10353849</number></var><var name=\'plan_name\'><string>AriaS1_Master_Plan_304</string></var><var name=\'plan_desc\'><string>AriaS1_Master_Plan_301</string></var><var name=\'plan_instance_no\'><number>58690</number></var><var name=\'client_plan_instance_id\'><string>1438259295157</string></var><var name=\'plan_date\'><string>2015-07-30</string></var><var name=\'plan_units\'><number>1</number></var><var name=\'last_bill_date\'><string>2015-07-30</string></var><var name=\'next_bill_date\'><string>2015-08-30</string></var><var name=\'bill_thru_date\'><string>2015-08-29</string></var><var name=\'bill_day\'><number>30</number></var><var name=\'recurring_billing_interval\'><number>1</number></var><var name=\'billing_interval\'><number>1</number></var><var name=\'billing_ind\'><number>1</number></var><var name=\'display_ind\'><number>1</number></var><var name=\'rollover_months\'><null/></var><var name=\'rollover_plan_no\'><null/></var><var name=\'early_cancel_fee\'><null/></var><var name=\'early_cancel_min_months\'><number>2</number></var><var name=\'suspension_period\'><null/></var><var name=\'initial_plan_status\'><number>1</number></var><var name=\'rollover_plan_status\'><number>1</number></var><var name=\'rollover_plan_status_duration\'><null/></var><var name=\'rollover_plan_status_uom_cd\'><number>1</number></var><var name=\'init_free_period_duration\'><null/></var><var name=\'init_free_period_uom_cd\'><null/></var><var name=\'plan_2_assign_on_susp\'><null/></var><var name=\'default_notify_method\'><null/></var><var name=\'prepaid_ind\'><number>0</number></var><var name=\'currency_cd\'><string>usd</string></var><var name=\'rate_schedule_no\'><number>11269395</number></var><var name=\'rate_schedule_name\'><string>DefaultRateScheduleName-USD1</string></var><var name=\'rate_sched_is_default_ind\'><number>1</number></var><var name=\'supp_plan_ind\'><number>0</number></var><var name=\'plan_instance_status_cd\'><number>1</number></var><var name=\'plan_instance_status_label\'><string>Active</string></var><var name=\'plan_instance_status_date\'><string>2015-07-30</string></var><var name=\'dunning_state\'><number>0</number></var><var name=\'dunning_step\'><null/></var><var name=\'dunning_degrade_date\'><null/></var><var name=\'plan_assignment_date\'><string>2015-07-30</string></var><var name=\'plan_deprovisioned_date\'><null/></var><var name=\'client_receipt_id\'><null/></var><var name=\'client_plan_id\'><string>AriaS1_Master_Plan_304</string></var><var name=\'client_rollover_plan_id\'><null/></var><var name=\'client_plan_2_assign_on_susp\'><null/></var><var name=\'client_rate_schedule_id\'><string>OQNQU01_11269395</string></var><var name=\'proration_invoice_timing_cd\'><string>I</string></var><var name=\'master_plan_instance_no\'><number>58690</number></var><var name=\'client_master_plan_instance_id\'><string>1438259295157</string></var><var name=\'parent_plan_instance_no\'><null/></var><var name=\'client_parent_plan_instance_id\'><null/></var><var name=\'contract_rollover_plan_no\'><null/></var><var name=\'contract_rollover_client_plan_id\'><null/></var><var name=\'contract_rollover_rate_sched_no\'><null/></var><var name=\'contract_rollover_client_rate_sched_id\'><null/></var><var name=\'plan_services\'><array length=\'2\'><struct><var name=\'service_no\'><number>10003126</number></var><var name=\'service_desc\'><string>Donation</string></var><var name=\'is_recurring_ind\'><number>1</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>1</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>0</number></var><var name=\'coa_id\'><string>1002</string></var><var name=\'ledger_code\'><string>1002</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'client_service_id\'><string>10003126</string></var><var name=\'usage_type_cd\'><null/></var><var name=\'usage_type_name\'><null/></var><var name=\'usage_type_desc\'><null/></var><var name=\'usage_type_code\'><null/></var><var name=\'usage_unit_label\'><null/></var><var name=\'coa_code\'><string>Recurring Flat Fees COA Code</string></var><var name=\'fulfillment_based_ind\'><number>0</number></var><var name=\'all_service_supp_fields\'><null/></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>4343</number></var><var name=\'monthly_fee\'><number>4343</number></var><var name=\'client_rate_schedule_id\'><string>OQNQU01_11269395</string></var><var name=\'rate_tier_description\'><null/></var></struct></array></var></struct><struct><var name=\'service_no\'><number>10136229</number></var><var name=\'service_desc\'><string>Cancellation Fee</string></var><var name=\'is_recurring_ind\'><number>0</number></var><var name=\'is_usage_based_ind\'><number>0</number></var><var name=\'usage_type\'><null/></var><var name=\'taxable_ind\'><number>0</number></var><var name=\'is_tax_ind\'><number>0</number></var><var name=\'is_arrears_ind\'><number>0</number></var><var name=\'is_setup_ind\'><number>0</number></var><var name=\'is_misc_ind\'><number>0</number></var><var name=\'is_donation_ind\'><number>0</number></var><var name=\'is_order_based_ind\'><number>0</number></var><var name=\'is_cancellation_ind\'><number>1</number></var><var name=\'coa_id\'><string>10085069</string></var><var name=\'ledger_code\'><string>10085069</string></var><var name=\'display_ind\'><number>1</number></var><var name=\'tiered_pricing_rule\'><number>1</number></var><var name=\'is_min_fee_ind\'><number>0</number></var><var name=\'client_service_id\'><string>10003128</string></var><var name=\'usage_type_cd\'><null/></var><var name=\'usage_type_name\'><null/></var><var name=\'usage_type_desc\'><null/></var><var name=\'usage_type_code\'><null/></var><var name=\'usage_unit_label\'><null/></var><var name=\'coa_code\'><string>GL123456</string></var><var name=\'fulfillment_based_ind\'><number>0</number></var><var name=\'all_service_supp_fields\'><null/></var><var name=\'plan_service_rates\'><array length=\'1\'><struct><var name=\'rate_seq_no\'><number>1</number></var><var name=\'from_unit\'><number>1</number></var><var name=\'to_unit\'><null/></var><var name=\'rate_per_unit\'><number>100</number></var><var name=\'monthly_fee\'><null/></var><var name=\'client_rate_schedule_id\'><string>OQNQU01_11269395</string></var><var name=\'rate_tier_description\'><null/></var></struct></array></var></struct></array></var><var name=\'surcharges_all\'><null/></var><var name=\'product_fields\'><array length=\'4\'><struct><var name=\'field_name\'><string>PF2</string></var><var name=\'field_value\'><string>PF2</string></var></struct><struct><var name=\'field_name\'><string>SFDC_PlanName</string></var><var name=\'field_value\'><string>SFDC_PlanName</string></var></struct><struct><var name=\'field_name\'><string>PF1</string></var><var name=\'field_value\'><string>PF1</string></var></struct><struct><var name=\'field_name\'><string>PF_SAN</string></var><var name=\'field_value\'><string>PF_SAN</string></var></struct></array></var><var name=\'plan_instance_fields_detail\'><array length=\'3\'><struct><var name=\'field_name\'><string>PFI1</string></var><var name=\'field_value\'><string>PF 1</string></var></struct><struct><var name=\'field_name\'><string>PFI2</string></var><var name=\'field_value\'><string>PF 2</string></var></struct><struct><var name=\'field_name\'><string>PFI3</string></var><var name=\'field_value\'><string>PF 3</string></var></struct></array></var><var name=\'billing_group_no\'><number>38253</number></var><var name=\'client_billing_group_id\'><string>1438259368812</string></var><var name=\'dunning_group_no\'><number>31841</number></var><var name=\'client_dunning_group_id\'><string>31841</string></var></struct></array></var></struct></data></wddxPacket>');
      WDDXData result = d.deserialize(); 
      AriaClientPlanDetailsAllCallOut obj = new AriaClientPlanDetailsAllCallOut();
      obj.handleResult(result);     
   }
}